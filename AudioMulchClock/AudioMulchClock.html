<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<title></title>
<meta name="Generator" content="Cocoa HTML Writer">
<meta name="CocoaVersion" content="949.54">
<style type="text/css">
p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; min-height: 12.0px}
p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000}
p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #0000bf}
p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #bf0000}
p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #000000; min-height: 12.0px}
p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 9.0px Monaco; color: #606060}
span.s1 {font: 18.0px Helvetica}
span.s2 {text-decoration: underline}
span.s3 {color: #0000ff}
span.s4 {color: #1142e6}
span.s5 {color: #083aec}
span.s6 {color: #000000}
span.s7 {color: #0000bf}
span.s8 {color: #007300}
span.Apple-tab-span {white-space:pre}
</style>
</head>
<body>
<p class="p1"><span class="s1"><b>AudioMulchClock</b></span><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>clock that synchronises to AudioMulch over network</b></p>
<p class="p2"><br></p>
<p class="p1">AudioMulch is a program written by Ross Bencina. <span class="s2">http://www.audiomulch.com/</span></p>
<p class="p1">AudioMulchClock is a SuperCollider class for synchronising playback with this program via network sync.</p>
<p class="p2"><br></p>
<p class="p1">This clock has no notion of time in seconds. Rather time advances in ticks and each incoming network sync message includes a tick counter. There are 24 ticks per beat and 96 per bar (assuming 4/4).</p>
<p class="p1">A tick is roughly 1/24 seconds long at tempo 60bpm. Though network jitter will add and subtract to this value.</p>
<p class="p1">Sub tick accurate scheduling (precision lower than 1/24th of a beat) is also possible.</p>
<p class="p2"><br></p>
<p class="p1"><span class="s2">Network setup:</span></p>
<p class="p1">In AudioMulch's preference panel under <i>Network Sync</i>, set the <i>Send to address</i> to 127.0.0.1 and the corresponding UDP Port to 57120. Activate <i>Generate Network Sync</i> under the Control meny.</p>
<p class="p2"><br></p>
<p class="p1"><span class="s2">Known issues:</span></p>
<p class="p1">use separate clocks for different tasks. some bug i have not found yet.</p>
<p class="p1">pbind legato does not behave correctly.<span class="Apple-converted-space">Â  </span>scale it with beat duration.</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><b><span class="Apple-tab-span">	</span>*new(waitForStart)</b></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>creates a new clock.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>waitForStart</b> - a <a href="SC://Boolean"><span class="s3">Boolean</span></a> indicating if this clock should wait for incoming \t_start message or not.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>it is false by default.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><span class="Apple-tab-span">	</span><b>play(task, quant)</b></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>schedules a function to be evaluated at some future beat - usually the next beat or next 4 beats (bar).</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>task</b> - a <a href="SC://Function"><span class="s3">Function</span></a>. The function is passed tick, time and clock as first three arguments.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>quant</b> - 1 plays on the next beat, 4 on the next bar etc. The default is 1.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Also fractions of beats are possible.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><b><span class="Apple-tab-span">	</span>schedAbs(tick, item)</b></p>
<p class="p1"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>schedules a function to be evaluated at a certain <i>tick</i>.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>tick</b> - use .tick to find the current tick and then add an offset in ticks to that.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Also fractions of ticks are possible for sub tick accuracy.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>item</b> - a <a href="SC://Function"><span class="s3">Function</span></a>. The function is passed tick, time and clock as first three arguments.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if the function returns a number, it will be rescheduled in that amount of beats.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><b><span class="Apple-tab-span">	</span>sched(delta, item)</b></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>schedules a function to be evaluated at some future beat.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>delta</b> - 1 here means the next upcoming beat.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Also fractions of beats are possible as well as sub tick accuracy (1&lt;24th of a beat).</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>item</b> - a <a href="SC://Function"><span class="s3">Function</span></a>. The function is passed tick, time and clock as first three arguments.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>if the function returns a number, it will be rescheduled in that amount of beats.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><b><span class="Apple-tab-span">	</span>nextTimeOnGrid(quant, phase)</b></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>used for finding out at which tick in the future the next beat or bar will occur.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>quant</b> - if 1 then return the tick for the next tick%24==0. If 4 then the tick for the next tick%96==0 etc.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><b>phase</b> - adds to the quant. e.g. quant 4 and phase 2 will return the tick at the next bar + two beats.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><span class="Apple-tab-span">	</span><b>clear</b></p>
<p class="p1"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>stops the clock and removes all tasks from the scheduling queue.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><span class="Apple-tab-span">	</span><b>beatDur</b></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>return the average beat duration in seconds.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Note: this value will fluctuate because of network jitter.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><span class="Apple-tab-span">	</span><b>beats</b></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>return the current beat.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><b><span class="Apple-tab-span">	</span>&lt;running</b></p>
<p class="p1"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>A <a href="SC://Boolean"><span class="s4">Boolean</span></a> that is set when a \t_start message is received.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><b><span class="Apple-tab-span">	</span>&lt;synced</b></p>
<p class="p1"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>A <a href="SC://Boolean"><span class="s4">Boolean</span></a> that is set when the first tick%96==0 is found.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><b><span class="Apple-tab-span">	</span>&lt;tick</b></p>
<p class="p1"><b><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></b>An <a href="SC://Integer"><span class="s4">Integer</span></a> that counts up indefinitely.</p>
<p class="p2"><span class="Apple-tab-span">	</span></p>
<p class="p1"><b><span class="Apple-tab-span">	</span>&lt;tempo</b></p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>A <a href="SC://Float"><span class="s5">Float</span></a> that represents the average tempo in beats per minutes.</p>
<p class="p1"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>Note: this value will fluctuate because of network jitter.</p>
<p class="p2"><br></p>
<p class="p3"><br></p>
<p class="p4">s.boot</p>
<p class="p5"><span class="s6">a= </span>AudioMulchClock<span class="s6">(</span>false<span class="s6">);</span></p>
<p class="p6">//now press play in AudioMulch - make sure 'Generate Network Sync' is set under the control menu.</p>
<p class="p4">a.synced</p>
<p class="p6"><span class="s6">a.beatDur<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>//will fluctuate because of network jitter</p>
<p class="p4">a.beats</p>
<p class="p6"><span class="s6">a.tempo<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>//will fluctuate because of network jitter</p>
<p class="p4">a.tick</p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p6">//--patterns - note that legato needs to be scaled down - still not working properly</p>
<p class="p4">b= <span class="s7">Pbind</span>(<span class="s8">\degree</span>, <span class="s7">Pseq</span>([0, 5, 2, 1, 0, 5, 2, 1, 0, -1], <span class="s7">inf</span>), <span class="s8">\dur</span>, <span class="s7">Pseq</span>([1, 1, 1, 1, 0.25, 0.25, 0.5, 1, 1, 1], <span class="s7">inf</span>), <span class="s8">\legato</span>, <span class="s7">Pfunc</span>({a.beatDur})).play(a, quant:4)</p>
<p class="p4">b.stop</p>
<p class="p6">//now try changing tempo in AudioMulch</p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p6">//--show manual scheduling in beats</p>
<p class="p5"><span class="s6">a= </span>AudioMulchClock<span class="s6">(</span>false<span class="s6">);</span></p>
<p class="p4">(</p>
<p class="p5"><span class="s6">a.sched(3.5, {</span>|tick, time, clock|</p>
<p class="p8"><span class="s6"><span class="Apple-tab-span">	</span>(</span>"3.5 beats later - relative to now"<span class="s6">+tick+time+clock).postln;</span></p>
<p class="p5"><span class="s6"><span class="Apple-tab-span">	</span></span>nil<span class="s6">;</span></p>
<p class="p4">})</p>
<p class="p4">)</p>
<p class="p7"><br></p>
<p class="p4">(</p>
<p class="p6">//note: schedAbs works in ticks so you need to scale with ticks per beat (24)</p>
<p class="p4">a.schedAbs(a.tick+(2*24), {<span class="s7">|tick, time, clock|</span></p>
<p class="p8"><span class="s6"><span class="Apple-tab-span">	</span>(</span>"2 beats later - absolute time"<span class="s6">+tick+time+clock).postln;</span></p>
<p class="p5"><span class="s6"><span class="Apple-tab-span">	</span></span>nil<span class="s6">;</span></p>
<p class="p4">})</p>
<p class="p4">)</p>
<p class="p7"><br></p>
<p class="p4">(</p>
<p class="p6">//schedules a synth at half a beat after the beginning of the next bar</p>
<p class="p4">a.schedAbs(a.nextTimeOnGrid(4, 0.5), {<span class="s7">|tick, time, clock|</span></p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="s7">var</span> syn= <span class="s7">Synth</span>(<span class="s8">\default</span>);</p>
<p class="p4"><span class="Apple-tab-span">	</span>a.sched(1, {</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>syn.release;</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s7">nil</span>;</p>
<p class="p4"><span class="Apple-tab-span">	</span>});</p>
<p class="p6"><span class="s6"><span class="Apple-tab-span">	</span>4;<span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>//reschedule every 4 beat</p>
<p class="p4">})</p>
<p class="p4">)</p>
<p class="p4">a.clear</p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p7"><br></p>
<p class="p6">//--note: use separate clocks for now - some problem</p>
<p class="p4">(</p>
<p class="p5">SynthDef<span class="s6">(</span><span class="s8">\audiomulchclock</span><span class="s6">, {</span>|out= 0, atk= 0.01, rel= 0.2, gate= 1, freq= 400, pan= 0, amp= 1|</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="s7">var</span> env= <span class="s7">EnvGen</span>.kr(<span class="s7">Env</span>.asr(atk, amp, rel), gate, doneAction:2);</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="s7">var</span> src= <span class="s7">MoogFF</span>.ar(</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="s7">Pulse</span>.ar(freq-(amp-env*50), env*0.25+0.5, env),</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>env.lag(2).exprange(freq*0.5, freq*2),</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>3</p>
<p class="p4"><span class="Apple-tab-span">	</span>);</p>
<p class="p4"><span class="Apple-tab-span">	</span><span class="s7">Out</span>.ar(out, <span class="s7">Pan2</span>.ar(src, pan));</p>
<p class="p4">}).add;</p>
<p class="p4">)</p>
<p class="p5"><span class="s6">a= </span>AudioMulchClock<span class="s6">(</span>false<span class="s6">);</span></p>
<p class="p4">b= <span class="s7">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\audiomulchclock</span>, <span class="s8">\degree</span>, <span class="s7">Pseq</span>([0, 5, 2, 1, 0, 5, 2, 1], <span class="s7">inf</span>)*[1, 0.5], <span class="s8">\strum</span>, 0.2, <span class="s8">\dur</span>, 0.5, <span class="s8">\pan</span>, [0.5, -0.5], <span class="s8">\amp</span>, cos(<span class="s7">Ptime</span>()*0.3), <span class="s8">\legato</span>, <span class="s7">Pfunc</span>({a.beatDur})).play(a, quant:4);</p>
<p class="p5"><span class="s6">c= </span>AudioMulchClock<span class="s6">(</span>false<span class="s6">);</span></p>
<p class="p4">d= <span class="s7">Pbind</span>(<span class="s8">\instrument</span>, <span class="s8">\audiomulchclock</span>, <span class="s8">\degree</span>, <span class="s7">Pn</span>(<span class="s7">Pshuf</span>([0, 5, 2, 1, 0, 5, 2, 1], 4), <span class="s7">inf</span>)*[1, 0.5], <span class="s8">\strum</span>, 0.1, <span class="s8">\dur</span>, 0.5, <span class="s8">\pan</span>, [-0.5, 0.5], <span class="s8">\amp</span>, cos(<span class="s7">Ptime</span>()*0.2), <span class="s8">\legato</span>, <span class="s7">Pfunc</span>({c.beatDur}), <span class="s8">\octave</span>, 7).play(c, quant:4);</p>
<p class="p4">d.stop</p>
<p class="p4">b.stop</p>
<p class="p4">c.clear</p>
<p class="p4">a.clear</p>
</body>
</html>
